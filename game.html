<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Stats with Dragon Egg</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body {
            margin: 0;
            padding: 0;
            font-family: 'Press Start 2P', cursive;
            background-color: #1e1e2f;
            position: relative;
            height: 100vh;
            overflow: hidden;
            color: #fff;
        }

        .container {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            border: 2px solid #f39c12;
            padding: 15px;
            border-radius: 10px;
            width: 300px;
            box-shadow: 0px 0px 20px rgba(243, 156, 18, 0.5);
            word-wrap: break-word;
            overflow: hidden;
        }

        #user-stats-container {
            top: 10px;
            left: 10px;
        }

        #egg-dragon-stats-container {
            top: 10px;
            right: 10px;
        }

        #huevo,
        #dragon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: auto;
            cursor: pointer;
            image-rendering: pixelated;
            animation: float 3s ease-in-out infinite;
            opacity: 1;
            transition: opacity 1s ease-in-out;
        }

        .progress-container {
            width: 100%;
            background-color: #ddd;
            border-radius: 25px;
            margin-top: 10px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 20px;
            background-color: #4caf50;
            border-radius: 25px;
            text-align: center;
            line-height: 20px;
            color: white;
            white-space: nowrap;
            overflow: hidden;
        }

        .stat {
            font-size: 14px;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .title {
            font-size: 10px;
            margin-top: 10px;
            font-weight: bold;
            color: #f39c12;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            position: relative;
            margin-bottom: 15px;
        }

        .notification-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .notification {
            padding: 10px 15px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.3s ease-in-out;
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .exp-notification {
            background: linear-gradient(45deg, #f3ec78, #af4261);
        }

        .coin-notification {
            background: linear-gradient(45deg, #f39c12, #d35400);
        }

        .title-notification {
            background: linear-gradient(45deg, #8e44ad, #3498db);
        }

        .egg-notification {
            background: linear-gradient(45deg, #ff8c00, #ff4500);
        }

        .level-notification {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }

        @keyframes pulse {
            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }
        }

        img {
            width: 20px;
            vertical-align: middle;
        }

        @keyframes float {
            0% {
                transform: translate(-50%, -50%);
            }

            50% {
                transform: translate(-50%, -55%);
            }

            100% {
                transform: translate(-50%, -50%);
            }
        }

        #inventory-button {
            position: absolute;
            bottom: 10px;
            left: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            background-color: #555;
            color: white;
            border-radius: 5px;
            box-shadow: 0px 0px 20px rgba(243, 156, 18, 0.5);
            font-family: 'Press Start 2P', cursive;
        }

        #inventory-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
        }

        #inventory-container {
            background-color: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(4, 65px);
            gap: 10px;
        }

        .inventory-slot {
            width: 65px;
            height: 65px;
            border: 2px solid #f39c12;
            background-color: #34495e;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            cursor: pointer;
        }

        .inventory-slot img {
            max-width: 100%;
            max-height: 100%;
        }

        .inventory-slot.occupied img {
            opacity: 0.5;
        }

        .slot-label {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 12px;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }

        .option-button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #ff8c00;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            text-align: center;
            border-radius: 5px;
            font-family: 'Press Start 2P', cursive;
        }

        .option-button:hover {
            background-color: #ff4500;
        }

        .modal-content {
            background-color: #34495e;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .modal.open {
            display: flex;
        }

        .click-effect {
            position: absolute;
            width: 50px;
            animation: fadeInOut 1s ease-in-out;
            pointer-events: none;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: scale(0);
            }

            50% {
                opacity: 1;
                transform: scale(1);
            }

            100% {
                opacity: 0;
                transform: scale(0);
            }
        }
    </style>
</head>

<body>

    <!-- User Stats Container -->
    <div id="user-stats-container" class="container">
        <h2>User Stats</h2>
        <div id="user-stats">
            <div class="title">Title: <span id="titulo">None</span></div>
            <div class="stat">Level: <span id="nivelUsuario">1</span></div>
            <div class="stat">Exp: <span id="experiencia">0</span> / <span id="maxExp">100</span></div>
            <div class="progress-container">
                <div id="progressExp" class="progress-bar" style="width: 0%;">0%</div>
            </div>
            <div class="stat">Click Value: <span id="valorClick">1</span><span id="bonusClick"></span></div>
            <div class="stat">Coins: <span id="monedas">0</span><img src="https://i.imgur.com/5MbUxQA.png" alt="Coin"
                    style="width: 16px;"></div>
        </div>
    </div>

    <!-- Egg/Dragon Stats Container -->
    <div id="egg-dragon-stats-container" class="container">
        <h2>Egg Stats</h2>
        <div id="egg-stats">
            <div class="stat">Rarity: Basic</div>
            <div class="stat">Type: ???</div>
            <div class="stat">Power: ???</div>
            <div class="stat">Nature: ???</div>
            <div class="stat">Gender: ???</div>
            <div class="stat">Vitality: ???</div>
            <div class="progress-container">
                <div id="progressEgg" class="progress-bar" style="width: 0%;">0%</div>
            </div>
        </div>

        <div id="dragon-stats" style="display: none;">
            <div class="stat">Level: <span id="nivelDragon">1</span></div>
            <div class="progress-container">
                <div id="progressDragon" class="progress-bar" style="width: 0%;">0%</div>
            </div>
            <div class="stat">Rarity: Basic</div>
            <div class="stat">Type: <span id="tipoDragon">???</span></div>
            <div class="stat">Power: <span id="poderDragon">1</span></div>
            <div class="stat">Nature: <span id="naturalezaDragon">???</span></div>
            <div class="stat">Gender: <span id="sexoDragon">???</span></div>
            <div class="stat">Vitality: <span id="vitalidadDragon">1</span></div>
        </div>
    </div>

    <!-- Egg Image for Interaction -->
    <img id="huevo" src="https://i.imgur.com/ad6PLfN.png" alt="Dragon Egg">
    <img id="dragon" src="https://i.imgur.com/XaPR5kU.png" alt="Dragon" style="display:none;">
    <img id="hatching-gif" src="https://i.imgur.com/m0qlZ0a.gif" alt="Hatching Animation" style="display: none;position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);z-index: 1000;width: 300px;height: auto;">
    <img id="crash-effect" src="https://i.imgur.com/5cZw0i6.png" alt="CRASH"
        style="display:none; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width:200px; z-index: 1000;">

    <!-- Inventory Button -->
    <button id="inventory-button">Inventory</button>

    <!-- Inventory Modal -->
    <div id="inventory-modal">
        <div id="inventory-container"></div>
        <span class="modal-close" onclick="closeInventoryModal()">✖</span>
    </div>

    <!-- Option Modals -->
    <div id="incubateModal" class="modal">
        <div class="modal-content">
            <p>Are you sure you want to incubate this egg?</p>
            <button onclick="confirmIncubate()">Yes</button>
            <button onclick="closeModal('incubateModal')">No</button>
        </div>
    </div>

    <div id="sacrificeModal" class="modal">
        <div class="modal-content">
            <p>Are you sure you want to sacrifice this egg for EXP?</p>
            <button onclick="confirmSacrifice()">Yes</button>
            <button onclick="closeModal('sacrificeModal')">No</button>
        </div>
    </div>

    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <p>Are you sure you want to withdraw this item from the incubator?</p>
            <button onclick="withdrawItem(currentEggOrDragon.index)" class="option-button">Yes</button>
            <button onclick="closeModal('withdrawModal')" class="option-button">No</button>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <script>
        let userLevel = 1;
        let experience = 0;
        let maxExperience = 100;
        let baseClickValue = userLevel; 
        let clickBonus = 0;
        let coins = 0;
        const clickExpBase = 5;

        let eggProgress = 0;
        const eggClicksNeeded = 100;

        let dragonLevel = 1;
        let dragonProgress = 0;
        let dragonClicksNeeded = 100;

        const userLevelSpan = document.getElementById('nivelUsuario');
        const experienceSpan = document.getElementById('experiencia');
        const maxExperienceSpan = document.getElementById('maxExp');
        const progressExp = document.getElementById('progressExp');
        const clickValueSpan = document.getElementById('valorClick');
        const bonusClickSpan = document.getElementById('bonusClick');
        const coinsSpan = document.getElementById('monedas');
        const titleSpan = document.getElementById('titulo');

        const egg = document.getElementById('huevo');
        const dragon = document.getElementById('dragon');
        const hatchingGif = document.getElementById('hatching-gif');
        const crashEffect = document.getElementById('crash-effect');
        const notificationContainer = document.getElementById('notificationContainer');

        const eggStats = document.getElementById('egg-stats');
        const dragonStats = document.getElementById('dragon-stats');

        const progressEgg = document.getElementById('progressEgg');
        const progressDragon = document.getElementById('progressDragon');

        const inventoryButton = document.getElementById('inventory-button');
        const inventoryModal = document.getElementById('inventory-modal');
        const inventoryContainer = document.getElementById('inventory-container');

        const inventory = [];
        let currentEggOrDragon = null;

        const titles = [
            { name: "Recruit Breeder", level: 5, clickBonus: 5, color: "hsl(0, 100%, 50%)" },
            { name: "Young Tamer", level: 10, clickBonus: 10, color: "hsl(7, 100%, 50%)" },
            { name: "Wyrmling Keeper", level: 15, clickBonus: 15, color: "hsl(14, 100%, 50%)" },
            { name: "Scale Squire", level: 20, clickBonus: 20, color: "hsl(21, 100%, 50%)" },
            { name: "Flame Tamer", level: 25, clickBonus: 25, color: "hsl(28, 100%, 50%)" },
            { name: "Dragon Rider", level: 30, clickBonus: 30, color: "hsl(35, 100%, 50%)" },
            { name: "Breeder Adept", level: 35, clickBonus: 35, color: "hsl(42, 100%, 50%)" },
            { name: "Sky Guardian", level: 40, clickBonus: 40, color: "hsl(49, 100%, 50%)" },
            { name: "Scale Connoisseur", level: 45, clickBonus: 45, color: "hsl(56, 100%, 50%)" },
            { name: "Lore Seeker", level: 50, clickBonus: 50, color: "hsl(63, 100%, 50%)" },
            { name: "Wyrm Breeder", level: 55, clickBonus: 55, color: "hsl(70, 100%, 50%)" },
            { name: "Elder Keeper", level: 60, clickBonus: 60, color: "hsl(77, 100%, 50%)" },
            { name: "Drake Seer", level: 65, clickBonus: 65, color: "hsl(84, 100%, 50%)" },
            { name: "Dragon Master", level: 70, clickBonus: 70, color: "hsl(91, 100%, 50%)" },
            { name: "Wyrm Warden", level: 75, clickBonus: 75, color: "hsl(98, 100%, 50%)" },
            { name: "Storm Lord", level: 80, clickBonus: 80, color: "hsl(105, 100%, 50%)" },
            { name: "Fire Warden", level: 85, clickBonus: 85, color: "hsl(112, 100%, 50%)" },
            { name: "Celestial Rider", level: 90, clickBonus: 90, color: "hsl(119, 100%, 50%)" },
            { name: "Dragon Lord", level: 95, clickBonus: 95, color: "hsl(126, 100%, 50%)" },
            { name: "Master of Dragons", level: 100, clickBonus: 100, color: "hsl(133, 100%, 50%)" }
        ];

        const types = ["Flama", "Electro", "Freez", "Wind"];
        const natures = ["Malignant", "Divine"];
        const genders = ["Male", "Female"];

        const dragonImages = {
            "Flama": "https://i.imgur.com/S0qMZRp.png",
            "Electro": "https://i.imgur.com/L6PVNVJ.png",
            "Freez": "https://i.imgur.com/pdwYzy6.png",
            "Wind": "https://i.imgur.com/XaPR5kU.png"
        };

        inventory.push({ type: 'egg', progress: 0, rarity: 'Basic' });

        egg.addEventListener('click', () => {
            const expPerClick = clickExpBase + (userLevel - 1);
            experience += expPerClick;

            eggProgress += baseClickValue + clickBonus;

            showNotification(`+${expPerClick} EXP`, 'exp-notification');
            showClickEffect(egg);

            if (experience >= maxExperience) {
                experience -= maxExperience;
                levelUpUser();
            }

            if (eggProgress >= eggClicksNeeded) {
                hatchEgg();
            } else {
                updateEggProgress();
            }

            updateStats();
        });

        dragon.addEventListener('click', () => {
            const expPerClick = clickExpBase + (userLevel - 1);
            experience += expPerClick;

            dragonProgress += baseClickValue + clickBonus;

            showNotification(`+${expPerClick} EXP`, 'exp-notification');
            showClickEffect(dragon);

            if (experience >= maxExperience) {
                experience -= maxExperience;
                levelUpUser();
            }

            if (dragonProgress >= dragonClicksNeeded) {
                levelUpDragon();
            } else {
                updateDragonProgress();
            }

            updateStats();
        });

        function updateEggProgress() {
            const percentage = (eggProgress / eggClicksNeeded) * 100;
            progressEgg.style.width = `${percentage}%`;
            progressEgg.textContent = `${Math.round(percentage)}%`;

            if (inventory[currentEggOrDragon?.index]?.type === 'egg') {
                inventory[currentEggOrDragon.index].progress = Math.round(percentage);
                renderInventory();
            }

            if (percentage >= 25 && percentage < 50) {
                showNotification("The egg is cracking!", 'egg-notification');
            } else if (percentage >= 50 && percentage < 75) {
                showNotification("The egg is almost ready!", 'egg-notification');
            } else if (percentage >= 75 && percentage < 100) {
                showNotification("This egg is about to hatch!", 'egg-notification');
            }
        }

        function updateDragonProgress() {
            const percentage = (dragonProgress / dragonClicksNeeded) * 100;
            progressDragon.style.width = `${percentage}%`;
            progressDragon.textContent = `${Math.round(percentage)}%`;
        }

        function hatchEgg() {
            const type = types[Math.floor(Math.random() * types.length)];
            const nature = natures[Math.floor(Math.random() * natures.length)];
            const gender = genders[Math.floor(Math.random() * genders.length)];
            const power = Math.floor(Math.random() * 3) + 1;
            const vitality = Math.floor(Math.random() * 3) + 1;

            document.getElementById('tipoDragon').textContent = type;
            document.getElementById('naturalezaDragon').textContent = nature;
            document.getElementById('sexoDragon').textContent = gender;
            document.getElementById('poderDragon').textContent = power;
            document.getElementById('vitalidadDragon').textContent = vitality;

            dragon.src = dragonImages[type];

            fadeOut(egg, 1000, () => {
                egg.style.display = 'none';
                fadeIn(crashEffect, 1000, () => {
                    setTimeout(() => {
                        fadeOut(crashEffect, 1000, () => {
                            crashEffect.style.display = 'none';
                            fadeIn(hatchingGif, 1000, () => {
                                setTimeout(() => {
                                    fadeOut(hatchingGif, 1000, () => {
                                        hatchingGif.style.display = 'none';
                                        fadeIn(dragon, 1000, () => {
                                            eggStats.style.display = 'none';
                                            dragonStats.style.display = 'block';

                                            document.querySelector("#egg-dragon-stats-container h2").textContent = "Dragon Stats";

                                            inventory[currentEggOrDragon.index] = {
                                                type: 'dragon',
                                                level: 1,
                                                rarity: 'Basic',
                                                type: type,
                                                nature: nature,
                                                gender: gender,
                                                power: power,
                                                vitality: vitality
                                            };
                                            dragonProgress = 0;
                                            updateDragonProgress();
                                            renderInventory();
                                        });
                                    });
                                }, 2000); // Duración de la animación del GIF (2 segundos)
                            });
                        });
                    }, 1000); // Duración de la imagen "CRASH"
                });
            });
        }

        function fadeOut(element, duration, callback) {
            element.style.transition = `opacity ${duration}ms ease-in-out`;
            element.style.opacity = 0;
            setTimeout(callback, duration);
        }

        function fadeIn(element, duration, callback) {
            element.style.display = 'block';
            element.style.transition = `opacity ${duration}ms ease-in-out`;
            element.style.opacity = 1;
            setTimeout(callback, duration);
        }

        function levelUpUser() {
            userLevel++;
            baseClickValue = userLevel;
            maxExperience = Math.floor(maxExperience * 1.5);
            const coinsEarned = getRandomCoins(userLevel);
            coins += coinsEarned;
            updateOrCreateNotification(`<img src="https://i.imgur.com/5MbUxQA.png" alt="Coin"> +${formatCoins(coinsEarned)} Coins`, 'coin-notification');
            updateOrCreateNotification(`You've reached level ${userLevel}!`, 'level-notification');

            checkForTitleUpgrade();
            updateStats();
        }

        function checkForTitleUpgrade() {
            const currentTitle = titles.find(title => userLevel >= title.level);
            if (currentTitle) {
                titleSpan.textContent = currentTitle.name;
                titleSpan.style.color = currentTitle.color;
                clickBonus = currentTitle.clickBonus;
                updateOrCreateNotification(`New Title: ${currentTitle.name}`, 'title-notification');
            }
        }

        function levelUpDragon() {
            dragonLevel++;
            dragonProgress = 0;
            dragonClicksNeeded = Math.floor(dragonClicksNeeded * 1.25);

            const dragonPower = document.getElementById('poderDragon');
            const dragonVitality = document.getElementById('vitalidadDragon');
            dragonPower.textContent = parseInt(dragonPower.textContent) + 1;
            dragonVitality.textContent = parseInt(dragonVitality.textContent) + 1;

            document.getElementById('nivelDragon').textContent = dragonLevel;
            showNotification(`Your dragon has reached level ${dragonLevel}!`, 'title-notification');

            inventory[currentEggOrDragon.index].level = dragonLevel;
            renderInventory();
        }

        function getRandomCoins(level) {
            return Math.floor(Math.random() * 3) + level;
        }

        function formatCoins(value) {
            if (value < 1000) return value;
            if (value < 1000000) return (value / 1000).toFixed(1) + 'k';
            return (value / 1000000).toFixed(1) + 'kk';
        }

        function showNotification(message, className) {
            const existingNotification = document.querySelector(`.${className}`);

            if (existingNotification) {
                existingNotification.innerHTML = message;
                existingNotification.style.opacity = '1';
                existingNotification.style.transform = 'scale(1)';
                existingNotification.style.animation = 'none';
                existingNotification.offsetHeight;
                existingNotification.style.animation = 'pulse 0.6s ease-in-out';

                clearTimeout(existingNotification.timeout);
                existingNotification.timeout = setTimeout(() => {
                    existingNotification.style.opacity = '0';
                    setTimeout(() => {
                        existingNotification.remove();
                    }, 1000);
                }, 3000);
            } else {
                const notification = document.createElement('div');
                notification.className = `notification ${className}`;
                notification.innerHTML = message;
                notification.style.animation = 'pulse 0.6s ease-in-out';
                notificationContainer.appendChild(notification);

                notification.style.opacity = '1';

                notification.timeout = setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        notification.remove();
                    }, 1000);
                }, 3000);
            }
        }

        function updateOrCreateNotification(message, className) {
            const existingNotification = document.querySelector(`.${className}`);
            if (existingNotification) {
                existingNotification.innerHTML = message;
                existingNotification.style.opacity = '1';
                clearTimeout(existingNotification.timeout);
                existingNotification.timeout = setTimeout(() => {
                    existingNotification.style.opacity = '0';
                    setTimeout(() => {
                        existingNotification.remove();
                    }, 1000);
                }, 3000);
            } else {
                const notification = document.createElement('div');
                notification.className = `notification ${className}`;
                notification.innerHTML = message;
                notificationContainer.appendChild(notification);

                notification.style.opacity = '1';

                notification.timeout = setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        notification.remove();
                    }, 1000);
                }, 3000);
            }
        }

        function renderInventory() {
            inventoryContainer.innerHTML = '';

            for (let i = 0; i < 20; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';

                if (inventory[i]) {
                    const item = inventory[i];
                    const img = document.createElement('img');
                    img.src = item.type === 'egg' ? 'https://i.imgur.com/ad6PLfN.png' : dragonImages[item.type];
                    slot.appendChild(img);

                    const label = document.createElement('div');
                    label.className = 'slot-label';

                    if (item.type === 'egg') {
                        label.textContent = `${item.progress}%`;
                        if (i === currentEggOrDragon?.index) {
                            img.style.opacity = 0.5;
                        }
                    } else if (item.type === 'dragon') {
                        label.textContent = `Lv. ${item.level}`;
                        if (i === currentEggOrDragon?.index) {
                            img.style.opacity = 0.5;
                        }
                    }

                    slot.appendChild(label);
                    slot.classList.add('occupied');
                    slot.addEventListener('click', () => selectInventoryItem(i));
                }

                inventoryContainer.appendChild(slot);
            }
        }

        function selectInventoryItem(index) {
            const item = inventory[index];
            if (!item) return;

            currentEggOrDragon = { type: item.type, index };

            if (item.type === 'egg') {
                openModal('eggOptionsModal');
            } else if (item.type === 'dragon') {
                openModal('dragonOptionsModal');
            }
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('open');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('open');
        }

        function confirmIncubate() {
            incubateEgg(currentEggOrDragon.index);
            closeModal('incubateModal');
        }

        function confirmSacrifice() {
            sacrificeEgg(currentEggOrDragon.index);
            closeModal('sacrificeModal');
        }

        function incubateEgg(index) {
            currentEggOrDragon = { type: 'egg', index };
            eggProgress = inventory[index].progress;
            dragon.style.display = 'none';
            egg.style.display = 'block';
            eggStats.style.display = 'block';
            dragonStats.style.display = 'none';
            closeModal('incubateModal');
            renderInventory();
        }

        function withdrawItem(index) {
            const item = inventory[index];

            if (item.type === 'egg') {
                if (currentEggOrDragon?.index === index) {
                    currentEggOrDragon = null;
                    egg.style.display = 'none';
                    eggStats.style.display = 'none';
                    renderInventory();
                }
            } else if (item.type === 'dragon') {
                if (currentEggOrDragon?.index === index) {
                    currentEggOrDragon = null;
                    dragon.style.display = 'none';
                    dragonStats.style.display = 'none';
                    renderInventory();
                }
            }

            closeModal('withdrawModal');
        }

        function sacrificeEgg(index) {
            let expGain = 0;
            if (inventory[index].rarity === 'Basic') expGain = 2500;
            experience += expGain;
            checkLevelUpAfterSacrifice(expGain);
            inventory.splice(index, 1);
            currentEggOrDragon = null;
            egg.style.display = 'none';
            eggStats.style.display = 'none';
            renderInventory();
            showNotification(`You gained ${expGain} EXP by sacrificing the egg`, 'exp-notification');
            closeModal('sacrificeModal');
        }

        function checkLevelUpAfterSacrifice(expGain) {
            while (experience >= maxExperience) {
                experience -= maxExperience;
                levelUpUser();
            }
            updateStats();
        }

        function openInventoryModal() {
            inventoryModal.style.display = 'flex';
            renderInventory();
        }

        function closeInventoryModal() {
            inventoryModal.style.display = 'none';
        }

        inventoryButton.addEventListener('click', openInventoryModal);

        function updateStats() {
            userLevelSpan.textContent = userLevel;
            experienceSpan.textContent = experience;
            maxExperienceSpan.textContent = maxExperience;
            progressExp.style.width = (experience / maxExperience) * 100 + '%';
            progressExp.textContent = `${Math.round((experience / maxExperience) * 100)}%`;
            clickValueSpan.textContent = baseClickValue;
            bonusClickSpan.textContent = clickBonus ? ` + ${clickBonus}` : '';
            bonusClickSpan.style.color = titleSpan.style.color;
            coinsSpan.textContent = formatCoins(coins);
        }

        function showClickEffect(target) {
            const clickImg = document.createElement('img');
            clickImg.src = 'https://i.imgur.com/CB9ycnj.png';
            clickImg.className = 'click-effect';

            const offsetX = Math.random() * 100 - 50;
            const offsetY = Math.random() * 100 - 50;
            const rect = target.getBoundingClientRect();

            clickImg.style.left = `${rect.left + rect.width / 2 + offsetX}px`;
            clickImg.style.top = `${rect.top + rect.height / 2 + offsetY}px`;

            document.body.appendChild(clickImg);

            setTimeout(() => {
                clickImg.remove();
            }, 1000);
        }

        updateStats();
        renderInventory();
    </script>
</body>

</html>
